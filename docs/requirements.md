# tmuxui 要件定義書

**バージョン**: 1.0
**最終更新**: 2026年2月21日

---

## プロジェクト概要

PCで tmux + Claude Code エージェントチームによる開発中に、外出先のスマートフォンから tmux の各ペインを閲覧し、Claude Code の権限許可操作と指示入力ができるWebアプリケーション。

## 背景・課題

- デスク環境では複数エージェントが tmux セッションで並行実行
- 外出中も進捗確認と権限許可判断が必要
- 現状：PC側のセッションが必須で、スマホアクセスが困難

---

## ユーザー要件

### U1: ペイン閲覧

**要件**: スマートフォンから tmux の各ペイン内容をリアルタイムで確認できる

- エージェント別にペイン一覧を表示
- 個別ペインを選択すると詳細内容を表示
- ターミナル出力を整形して表示（モノスペース、ダークテーマ）

### U2: 権限許可操作

**要件**: Claude Code エージェント側の権限許可リクエストをスマートフォンで承認・拒否できる

- 実行予定のコマンド、対象エージェント、実行箇所を明示
- 誤操作防止のため確認ダイアログを必須化
- スマートフォン操作でリード側に承認結果を通知

### U3: 指示入力

**要件**: スマートフォンからエージェントへ新しい指示を送信できる

- テキスト入力フォーム（カスタム指示）
- よく使用するコマンドはプリセット化可能
- 送信前確認ダイアログで誤送信防止

### U4: フル端末アクセス不要

**要件**: セキュリティ上、スマートフォンからのフルターミナルアクセスは提供しない

- ペイン閲覧のみ（編集・削除不可）
- コマンド実行は権限許可と指示入力のみ
- 直接的なシェル操作は防止

### U5: 軽量・シンプル起動

**要件**: 最小の手間で起動でき、依存関係は最小限に保つ

- コマンド一つで起動（例：`./tmuxui`）
- localhost:someport でブラウザからアクセス可能
- 設定ファイル最小化（理想は設定不要）
- バイナリ + フロントエンド資源が一体型

### U6: ポートフォワード環境対応

**要件**: CDN 不要で、ポートフォワード環境での動作を確保

- すべての依存リソース（JS、CSS等）を内包
- 外部ネットワーク通信なし（ローカルホスト自己完結）

---

## 機能要件

### 機能 F1: ペイン一覧表示

| 項目 | 詳細 |
|------|------|
| **概要** | tmux セッションの構造（複数エージェント → 複数ペイン）を階層表示 |
| **UI** | タブ式リスト + ツリー構造（エージェント > ペイン） |
| **更新方式** | 手動更新（スマホネットワーク消費考慮） |
| **表示内容** | エージェント名、ペイン名、ペイン内容の先頭数行 |

### 機能 F2: ペイン詳細表示

| 項目 | 詳細 |
|------|------|
| **概要** | 選択されたペインの完全な内容をターミナル形式で表示 |
| **スクロール** | 上下スクロール対応（大量出力対応） |
| **タイムスタンプ** | "最終更新: HH:MM" を表示 |
| **更新ボタン** | 手動更新用 🔄 ボタン（回転アニメーション付き） |

### 機能 F3: 権限許可ダイアログ

| 項目 | 詳細 |
|------|------|
| **トリガー** | Claude Code リード側から permission request 発火 |
| **表示内容** | コマンド、対象エージェント、実行箇所、有効期限 |
| **ボタン** | [いいえ] [はい] （デフォルトフォーカス：いいえ） |
| **タップターゲット** | 最小 48px × 48px（Apple HIG 準拠） |
| **レスポンス** | Claude Code hooks へ承認結果を返送 |

### 機能 F4: 指示入力フォーム

| 項目 | 詳細 |
|------|------|
| **形式** | 折畳み式テキスト入力 |
| **プリセット** | よく使用するコマンドをボタン化 |
| **送信** | SendMessage ツール経由でエージェントに指示 |
| **確認** | カスタム入力時は送信前確認ダイアログ表示 |
| **文字数制限** | 最大 256 文字 |

### 機能 F5: ナビゲーション

| 項目 | 詳細 |
|------|------|
| **画面遷移** | ペイン一覧 → ペイン詳細 ↔ 戻る |
| **戻る操作** | ボタン or 右スワイプジェスチャ |
| **タブ切り替え** | エージェント間の移動（ホーム画面） |

### 機能 F6: デザイン・ビジュアル

| 項目 | 詳細 |
|------|------|
| **テーマ** | ダークモード（バッテリー節約 + CLI らしさ） |
| **フォント** | モノスペース（Menlo/Monaco/Courier New） |
| **色** | ANSI 標準色に合わせた配色 |
| **セーフエリア** | iPhone ノッチ・ホームインジケータ対応 |

---

## 非機能要件

### N1: パフォーマンス

| 項目 | 目標 |
|------|------|
| **起動時間** | 3秒以内 |
| **ページ遷移** | 500ms以内 |
| **ペイン更新** | 1秒以内 |
| **メモリ使用量** | 50MB以下（スマホ環境） |

### N2: セキュリティ

| 項目 | 詳細 |
|------|------|
| **認証** | Claude Code hooks との署名検証 |
| **通信** | localhost:port（ローカルネットワークのみ） |
| **セッション** | 10分無操作でセッション終了 |
| **入力検証** | コマンド実行前に確認ダイアログを必須化 |

### N3: 互換性

| 項目 | 詳細 |
|------|------|
| **iOS** | Safari、iOS 15以上 |
| **Android** | Chrome、Android 10以上 |
| **PWA** | ホーム画面追加に対応 |

### N4: 依存関係の最小化

| 項目 | 詳細 |
|------|------|
| **外部ライブラリ** | 最小限に制限（フロントエンド） |
| **バックエンド依存** | Go/Rust 推奨（軽量・高速） |
| **データベース** | 不要（ステートレス） |
| **CDN** | 使用しない |

### N5: 運用・保守性

| 項目 | 詳細 |
|------|------|
| **ドキュメント** | セットアップガイド、API仕様を整備 |
| **ログ** | 権限許可・指示送信のログ記録 |
| **エラーハンドリング** | ユーザーフレンドリーなエラーメッセージ |

---

## 制約・非機能

### 実装しない機能

❌ フルシェルアクセス
❌ ペイン削除・作成
❌ ペイン内容の編集
❌ ファイルアップロード
❌ ライトモード
❌ 複数 PC のセッション管理（PC 1台固定）

---

## 成功基準

1. ✅ スマートフォンから各ペインの内容が確認できる
2. ✅ 権限許可リクエストがスマートフォンで承認・拒否可能
3. ✅ 指示をエージェントへ送信できる
4. ✅ 起動コマンド 1 つで稼働
5. ✅ CDN 依存なし、ローカル自己完結
6. ✅ iOS・Android 両対応

---

## 関連ドキュメント

- **ux-design.md**: UI/UX 詳細設計
- **research.md**: 既存ソリューション調査
- **decisions.md**: 技術選定・設計判断ログ
